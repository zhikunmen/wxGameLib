/*!
 * wxGameLib - compressed JS
 * @licence wxGameLib - v0.1.0 (2019-02-14)
 *  qq:93749937 | Licence: helojo
 */

!function(e){var n=function(){function e(){}return e.DEVELOP="develop",e.TRIAL="trial",e.RELEASE="release",e}();e.envVersionConst=n;var t=function(){function e(){}return e.DEFAULTTITLE='回复"关注"获取关注链接',e}();e.CustomerServiceConst=t}(wxgame||(wxgame={}));var __awaiter=this&&this.__awaiter||function(r,a,s,c){return new(s||(s=Promise))(function(e,n){function t(e){try{o(c.next(e))}catch(e){n(e)}}function i(e){try{o(c.throw(e))}catch(e){n(e)}}function o(n){n.done?e(n.value):new s(function(e){e(n.value)}).then(t,i)}o((c=c.apply(r,a||[])).next())})},__generator=this&&this.__generator||function(t,i){var o,r,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function n(n){return function(e){return function(n){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,r&&(a=r[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(r,n[1])).done)return a;switch(r=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,r=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){s.label=n[1];break}if(6===n[0]&&s.label<a[1]){s.label=a[1],a=n;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(n);break}a[2]&&s.ops.pop(),s.trys.pop();continue}n=i.call(t,s)}catch(e){n=[6,e],r=0}finally{o=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,e])}}};!function(r){var e=function(){function e(){var n=this;this.isFirst=!0,this.bannerUnitIdArr=["adunit-1b42952355975af0"],this._bannerIndex=0,this._bannerIsReady=!1,this.onLoadBanner=function(){n._bannerIsReady=!0},this.onErrorBanner=function(e){n._bannerIsReady=!1,n._bannerIndex++,n._bannerIndex=n._bannerIndex>=n.bannerUnitIdArr.length?0:n._bannerIndex,console.log("广告拉取失败:"+JSON.stringify(e))},this.onResizeBanner=function(){n._bannerAd&&n._sysInfo&&(n._bannerAd.style.top=n._sysInfo.screenHeight-n._bannerAd.style.realHeight)},this.videoUnitIdArr=["adunit-ebbeeb9f7cbb945f"],this._videoAdCanUse=!0,this.onErrorVideo=function(e){console.log("视频拉取失败:"+JSON.stringify(e)),n._videoAdCanUse=!1},this.onCloseVideo=function(e){uniLib.SoundMgr.instance.resumeBgMusic(),e&&e.isEnded||null==e?n._videoCallFun&&n._videoCallFun.apply(n._vidoeCallObj):uniLib.TipsUtils.showTipsDownToUp("未观看完整视频不能获得奖励")}}return Object.defineProperty(e,"instance",{get:function(){return this._instance||(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return r.Utils.isWxGame?(this.isFirst&&(this.isFirst=!1,r.Message.instance.init(),r.ShareMessage.instance.showShareMenu(!0)),[2,new Promise(function(n,t){wx.login({success:function(e){n(e),console.log("login success: "+e.code)},fail:function(e){t(!1),console.error("login fail: "+e)},complete:function(){}})})]):[2]})})},e.prototype.exitMiniProgram=function(t,i,o){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return r.Utils.isWxGame?[2,new Promise(function(e,n){wx.exitMiniProgram({success:function(){t&&t(),e(!0)},fail:function(){i&&i(),n(!1)},complete:o})})]:[2]})})},e.prototype.openCustomerServiceConversation=function(e,i,o){return void 0===i&&(i=r.CustomerServiceConst.DEFAULTTITLE),__awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return r.Utils.isWxGame?[2,new Promise(function(n,t){wx.openCustomerServiceConversation({sessionFrom:"",showMessageCard:!0,sendMessageTitle:i,sendMessagePath:"",sendMessageImg:o?0<o.match(/http/gi).length?o+r.Utils.getVersionControlCode():o:"",success:function(e){n(e)},fail:function(e){t(e)}})})]:[2]})})},e.prototype.openSetting=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(n,t){wx.openSetting({success:function(e){n(e)},fail:function(e){t(e),console.log("打开设置失败")}})})]})})},e.prototype.authorize=function(i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(n,t){wx.authorize({scope:i,success:function(){n()},fail:function(){wx.showModal({title:"授权提示",content:"获取授权失败，请确认授权！",showCancel:!1,success:function(){r.Global.instance.openSetting().then(function(e){e.authSetting[i]?n():(uniLib.TipsUtils.showTipsDownToUp("授权失败请重试"),t())},function(e){t(e)}).catch(function(e){t(e)})}})}})})]})})},e.prototype.destroyBannerAd=function(){this._bannerAd&&(this._bannerAd.hide(),this._bannerAd.offResize(this.onResizeBanner),this._bannerAd.offError(this.onErrorBanner),this._bannerAd.offLoad(this.onLoadBanner),this._bannerAd.destroy(),this._bannerAd=null,this._bannerIsReady=!1,this.wxCreateBannerAd())},e.prototype.wxCreateBannerAd=function(e,n){this._sysInfo||(this._sysInfo=wx.getSystemInfoSync()),this._bannerAd=wx.createBannerAd({adUnitId:e||this.bannerUnitIdArr[this._bannerIndex],style:n||{left:(this._sysInfo.screenWidth-300)/2,top:this._sysInfo.screenHeight-86,width:300}}),this._bannerAd.onResize(this.onResizeBanner),this._bannerAd.onError(this.onErrorBanner),this._bannerAd.onLoad(this.onLoadBanner)},e.prototype.createBannerAd=function(e,n){uniLib.Global.isWxGame()&&(this._sysInfo||(this._sysInfo=wx.getSystemInfoSync()),this._bannerAd&&this._bannerIsReady?(n&&(null!=n.width&&(this._bannerAd.style.width=n.width),null!=n.top&&(this._bannerAd.style.top=n.top),null!=n.left&&(this._bannerAd.style.left=n.left),null!=n.right&&(this._bannerAd.style.left=this._sysInfo.screenWidth-this._bannerAd.style.realWidth)),this._bannerAd.show()):this.wxCreateBannerAd(e,n))},e.prototype.createRewardedVideoAd=function(e,n,t){var i=this;uniLib.Global.isWxGame()&&(0==this._videoAdCanUse?n&&n.call(t):this._videoAd?(this._videoCallFun=n,this._vidoeCallObj=t,this._videoAd.show().then(function(){i._videoAdCanUse=!0,uniLib.SoundMgr.instance.pauseBgMusic()},function(){i._videoAd.load().then(function(){i._videoAd.show()},function(){i._videoAdCanUse=!1,i._videoCallFun=null,i._vidoeCallObj=null,n&&n.apply(t)})})):wx.createRewardedVideoAd?(this._videoAd=wx.createRewardedVideoAd({adUnitId:e||this.videoUnitIdArr[0]}),this._videoAd.onLoad(function(){console.log("视频加载完毕")}),this._videoAd.onError(this.onErrorVideo),this._videoAd.onClose(this.onCloseVideo)):(this._videoAdCanUse=!1,uniLib.TipsUtils.showTipsDownToUp("微信版本过低请更新微信"),n&&n.call(t)))},e.prototype.aldSendEvent=function(e,n){egret.Capabilities.runtimeType==egret.RuntimeType.WXGAME&&wx.aldSendEvent&&wx.aldSendEvent(e,n)},e}();r.Global=e}(wxgame||(wxgame={})),function(i){var e=function(){function e(){}return Object.defineProperty(e,"instance",{get:function(){return this._instance||(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){this.launchOption=wx.getLaunchOptionsSync(),this.initLaunchOption(),this.addOnShowEvent(),this.onMemoryWarning()},e.prototype.initLaunchOption=function(){if(this.launchOption){var e,n=this.launchOption;n.query&&(e=n.query);var t=new uniLib.WXShareVo;t.opType=Cmd.ShareOpType.click,e.shareType&&(t.shareType=Number(e.shareType)),e.wgShareData&&(t.wgShareData=e.wgShareData),e&&e.uid&&(t.fromUid=Number(e.uid),n.shareTicket?i.ShareMessage.instance.getShareInfo(n.shareTicket).then(function(e){e&&0<=e.errMsg.indexOf("ok")&&(t.shareTicket=JSON.stringify(e),i.ShareMessage.instance.sendShareMessage(t))}).catch(function(e){console.log("获取群消息失败",e),uniLib.TipsUtils.showTipsDownToUp("获取群消息失败")}):i.ShareMessage.instance.sendShareMessage(t)),this.launchOption=null}},e.prototype.addOnShowEvent=function(){var n=this;wx.offShow(function(e){n.onShow(e)}),wx.onShow(function(e){n.onShow(e)})},e.prototype.onShow=function(e){wx.setKeepScreenOn({keepScreenOn:!0}),!this.launchOption&&e&&(this.launchOption=e),this.initLaunchOption()},e.prototype.setUserCloudStorage=function(e){return new Promise(function(n,t){wx.setUserCloudStorage({KVDataList:e,success:function(e){console.log("setUserCloudStorage success",e),n(e)},fail:function(e){console.error("setUserCloudStorage success",e),t(e)}})})},e.prototype.onMemoryWarning=function(){i.Utils.isIos||wx.onMemoryWarning(function(e){if(e&&e.level)switch(e.level){case 5:break;case 10:console.warn("内存较低"+e.level);break;case 15:console.warn("内存严重"+e.level)}})},e}();i.Message=e}(wxgame||(wxgame={})),function(n){var e=function(){function e(){}return Object.defineProperty(e,"instance",{get:function(){return this._instance||(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.sendShareData=function(e){n.Utils.isWxGame&&(this._openDataContext=wx.getOpenDataContext(),this._openDataContext.postMessage(e))},e.prototype.createDisplayObject=function(e,n,t,i){var o=window.sharedCanvas;o.width=n,o.height=t;var r=new egret.BitmapData(o);r.$deleteSource=!1;var a=new egret.Texture;a._setBitmapData(r);var s=new egret.Bitmap(a);(s.width=n,s.height=t,s.y=i,"webgl"==egret.Capabilities.renderMode)&&(egret.wxgame.WebGLRenderContext.getInstance().context.wxBindCanvasTexture||egret.startTick(function(e){return egret.WebGLUtils.deleteWebGLTexture(r.webGLTexture),r.webGLTexture=null,!1},this));return s},e}();n.OpenData=e}(wxgame||(wxgame={}));var wxgame;__awaiter=this&&this.__awaiter||function(r,a,s,c){return new(s||(s=Promise))(function(e,n){function t(e){try{o(c.next(e))}catch(e){n(e)}}function i(e){try{o(c.throw(e))}catch(e){n(e)}}function o(n){n.done?e(n.value):new s(function(e){e(n.value)}).then(t,i)}o((c=c.apply(r,a||[])).next())})},__generator=this&&this.__generator||function(t,i){var o,r,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function n(n){return function(e){return function(n){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,r&&(a=r[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(r,n[1])).done)return a;switch(r=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,r=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){s.label=n[1];break}if(6===n[0]&&s.label<a[1]){s.label=a[1],a=n;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(n);break}a[2]&&s.ops.pop(),s.trys.pop();continue}n=i.call(t,s)}catch(e){n=[6,e],r=0}finally{o=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,e])}}};!function(l){var e=function(){function e(){}return Object.defineProperty(e,"instance",{get:function(){return this._instance||(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.onShareAppMessage=function(i,o,r){void 0===i&&(i=""),void 0===o&&(o=""),void 0===r&&(r=""),wx.onShareAppMessage(function(e){if(!i||""==i.trim()){var n=void 0,t=l.Global.instance.tableLobbyGameList;t&&Array.isArray(t.newshareContent)&&(n=Math.floor(Math.random()*t.newshareContent.length),i=t.newshareContent[n],"/"!=l.Global.instance.shareIconUrl[l.Global.instance.shareIconUrl.length-1]&&(l.Global.instance.shareIconUrl+="/"),o=l.Global.instance.shareIconUrl+"shareIcons/"+t.newsharepicture[n])}return console.log("用户点击事件"),{title:i,imageUrl:o,query:r}})},e.prototype.showShareMenu=function(i){return void 0===i&&(i=!0),__awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(n,t){wx.showShareMenu({withShareTicket:i,success:function(e){console.log("showShareMenu success:  "+e),n(!0)},fail:function(e){console.log("showShareMenu fail:  "+e),t(!1)},complete:function(){}})})]})})},e.prototype.hideShareMenu=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(n,t){wx.hideShareMenu({success:function(e){console.log("hideShareMenu success:  "+e),n(!0)},fail:function(e){console.log("hideShareMenu fail:  "+e),t(!1)},complete:function(){}})})]})})},e.prototype.updateShareMenu=function(i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(n,t){wx.updateShareMenu({withShareTicket:i,success:function(e){console.log("updateShareMenu success:  "+e),n(!0)},fail:function(e){console.log("updateShareMenu fail:  "+e),t(!1)},complete:function(){}})})]})})},e.prototype.shareAppMessage=function(c,u,h){return __awaiter(this,void 0,void 0,function(){var t,i,n,o,r,a,s=this;return __generator(this,function(e){return uniLib.Global.isInGame&&(this._lastTimeOutSec=uniLib.Global.msgTimeOutSec,uniLib.Global.msgTimeOutSec=120),i=t="",(o=l.Global.instance.tableLobbyGameList)&&Array.isArray(o.newshareContent)&&(n=Math.floor(Math.random()*o.newshareContent.length)),c.title?t=c.title:isNaN(n)?uniLib.TipsUtils.showTipsDownToUp("分享标题配置有误"):t=o.newshareContent[n],c.shareImageUrl||c.shareImageData?(i=c.shareImageUrl?c.shareImageUrl:c.shareImageData,console.log("imageUrl:"+JSON.stringify(i))):!isNaN(n)&&l.Global.instance.shareIconUrl?("/"!=l.Global.instance.shareIconUrl[l.Global.instance.shareIconUrl.length-1]&&(l.Global.instance.shareIconUrl+="/"),i=l.Global.instance.shareIconUrl+"shareIcons/"+o.newsharepicture[n]):uniLib.TipsUtils.showTipsDownToUp("分享图片配置有误"),r="uid="+uniLib.UserInfo.uid,c.shareType&&(r+="&shareType="+c.shareType),c.roomId&&(a=JSON.parse(c.roomId))&&a.roomId&&(r+="&roomId="+a.roomId),c.wgShareData&&(r+="&wgShareData="+c.wgShareData),c.opType=Cmd.ShareOpType.share,u&&u(),this.sendShareMessage(c),[2,new Promise(function(n,e){wx.shareAppMessage({title:t,imageUrl:Array.isArray(i.match(/http/gi))&&0<i.match(/http/gi).length?i+l.Utils.getVersionControlCode():i,query:r,success:function(e){s.resetTimeSec(),console.log(e),u&&u(),e&&(e.shareTickets&&0<e.shareTickets.length||console.log("分享的是个人")),uniLib.TipsUtils.showTipsDownToUp("分享成功"),n(e)},fail:function(e){s.resetTimeSec(),h&&h(),uniLib.TipsUtils.showTipsDownToUp("分享失败"),n(!1)}})})]})})},e.prototype.getShareInfo=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(n,e){wx.getShareInfo({shareTicket:t,success:function(e){n(e)},fail:function(e){console.log("getShareInfo fail")},complete:function(){}})})]})})},e.prototype.sendShareMessage=function(o){return __awaiter(this,void 0,void 0,function(){var n,t,i;return __generator(this,function(e){switch(e.label){case 0:return[4,l.Global.instance.init().then(function(e){0<=e.errMsg.indexOf("ok")&&(n=e.code)},function(){egret.error("sendShareMessage reject")})];case 1:return e.sent(),this._data||!o?(n&&this._data&&this._data.shareType&&this._data.shareType==Cmd.ShareType.ios&&(i={},this._data.extData?(i=JSON.parse(this._data.extData)).code=n:i.code=n,this._data.extData=JSON.stringify(i)),this.sendShare(),[2]):(t=new Cmd.UploadShareInfoLittleGameLobbyCmd_CS,o.fromUid&&(t.uid=o.fromUid),o.shareType&&(t.shareType=o.shareType),o.opType&&(t.opType=o.opType),o.shareTicket&&(t.jsonShare=o.shareTicket),o.wgKvData&&(t.extData=o.wgKvData),o.wgShareData&&(t.extData=o.wgShareData),t.shareType&&t.shareType==Cmd.ShareType.ios&&n&&(i={},t.extData?(i=JSON.parse(t.extData)).code=n:i.code=n,t.extData=JSON.stringify(i)),this._data=t,this.sendShare(),[2])}})})},e.prototype.checkSession=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(n,t){wx.checkSession({success:function(e){n(e)},fail:function(e){t(e)}})})]})})},e.prototype.sendShare=function(){NetMgr.ws&&this._data&&(NetMgr.tcpSend(this._data),this._data=null)},e.prototype.resetTimeSec=function(){uniLib.Global.isInGame&&this._lastTimeOutSec&&(uniLib.Global.msgTimeOutSec=this._lastTimeOutSec)},e}();l.ShareMessage=e}(wxgame||(wxgame={})),function(n){var e=function(){function e(){}return e.showConfirm=function(e,n,t,i,o,r){if(void 0===n&&(n=""),void 0===t&&(t="确认"),uniLib.Global.isWxGame()){var a=!1;null!=o?a=!0:o="取消",wx.showModal({title:n,content:e,showCancel:a,cancelText:o,confirmText:t,success:function(e){e.confirm&&i&&i(),e.cancel&&r&&r()},fail:function(e){console.log("showModal调用失败")}})}},e.getVersionControlCode=function(){return"?v="+(new Date).getTime()},Object.defineProperty(e,"isWxGame",{get:function(){return!!uniLib.Global.isWxGame()||(console.warn("当前测试环境不是微信小游戏，导致功能失效"),!1)},enumerable:!0,configurable:!0}),e.getPosition=function(t,i){n.Global.instance.authorize("scope.userLocation").then(function(){wx.getLocation({success:function(e){var n={code:0,data:e};t.call(i,n)},fail:function(e){uniLib.TipsUtils.showTipsDownToUp("定位失败，请重试"+e);t.call(i,{code:-1})}})},function(e){uniLib.TipsUtils.showTipsDownToUp("接口调起失败"+e);t.call(i,{code:-1})})},Object.defineProperty(e,"isIos",{get:function(){if(!uniLib.Global.isWxGame())return uniLib.Utils.isIOS();try{return!!wx.getSystemInfoSync().system.match(/IOS/gi)}catch(e){return!1}},enumerable:!0,configurable:!0}),e.catchScreenToData=function(r,a,s){var c=wx.getSystemInfoSync();return new Promise(function(n,t){var e={quality:.7,fileType:"jpg",success:function(e){n(e.tempFilePath)},fail:function(e){uniLib.TipsUtils.showTipsDownToUp("截图失败！",e),t(e)}};if(r){var i=window.canvas.width/uniLib.Global.screenWidth,o=window.canvas.height/uniLib.Global.screenHeight;e.x=r.x*i,e.y=r.y*o,e.width=r.width*i,e.height=r.height*o,e.destWidth=r.width*c.pixelRatio,e.destHeight=r.height*c.pixelRatio}a&&(e.destWidth=a*c.pixelRatio),s&&(e.destHeight=s*c.pixelRatio),canvas.toTempFilePath(e)})},e.catchScreenToPathSync=function(e,n,t){var i=wx.getSystemInfoSync(),o={quality:.7,fileType:"jpg"};if(e){var r=window.canvas.width/uniLib.Global.screenWidth,a=window.canvas.height/uniLib.Global.screenHeight;o.x=e.x*r,o.y=e.y*a,o.width=e.width*r,o.height=e.height*a,o.destWidth=e.width*i.pixelRatio,o.destHeight=e.height*i.pixelRatio}return n&&(o.destWidth=n*i.pixelRatio),t&&(o.destHeight=t*i.pixelRatio),canvas.toTempFilePathSync(o)},e.catchScreenToTex=function(i,o){var r=wx.getSystemInfoSync();if(i){var a=o?o.width/r.screenWidth:uniLib.Global.screenWidth/r.screenWidth,s=o?o.height/r.screenHeight:uniLib.Global.screenHeight/r.screenHeight;return new Promise(function(n,e){var t={x:o?i.x:i.x*a,y:o?i.y:i.y*s,width:o?o.width>i.width?i.width:o.width:i.width*a,height:o?o.height>i.height?i.height:o.height:i.height*s,destWidth:640*r.pixelRatio,destHeight:512*r.pixelRatio,fileType:"jpg",success:function(e){n(e.tempFilePath)},fail:function(e){uniLib.TipsUtils.showTipsDownToUp("截图失败！",e),n(null)}};o?o.toTempFilePath(t):canvas.toTempFilePath(t)})}return new Promise(function(n,t){canvas.toTempFilePath({success:function(e){n(e.tempFilePath)},fail:function(e){console.log("截图失败"),t(e)}})})},e.compareVersion=function(e,n){for(var t=e.split("."),i=n.split("."),o=Math.max(t.length,i.length);t.length<o;)t.push("0");for(;i.length<o;)i.push("0");for(var r=0;r<o;r++){var a=parseInt(t[r]),s=parseInt(i[r]);if(s<a)return 1;if(a<s)return-1}return 0},e}();n.Utils=e}(wxgame||(wxgame={}));